// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// Enums
enum KYCStatus {
  PENDING
  VERIFIED
  REJECTED
}

enum SubscriptionTier {
  BASIC
  PREMIUM
  ENTERPRISE
}

enum AssetType {
  STOCK
  MUTUAL_FUND
  ETF
  BOND
  COMMODITY
}

enum OrderType {
  MARKET
  LIMIT
}

enum OrderSide {
  BUY
  SELL
}

enum OrderStatus {
  PENDING
  EXECUTED
  CANCELLED
}

enum TransactionType {
  DEPOSIT
  WITHDRAWAL
  INVESTMENT
}

enum TransactionStatus {
  PENDING
  COMPLETED
  FAILED
}

// Models
model User {
  id              String   @id @default(cuid())
  email           String   @unique
  phone           String?  @unique
  password        String?
  name            String?
  avatar          String?
  kycStatus       KYCStatus @default(PENDING)
  isVerified      Boolean  @default(false)
  level           Int      @default(1)
  xp              Int      @default(0)
  subscriptionTier SubscriptionTier @default(BASIC)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  accounts        Account[]
  portfolios      Portfolio[]
  orders          Order[]
  transactions    Transaction[]
  kycDocuments    KYCDocument[]
  wallet          Wallet?
  
  @@map("users")
}

model Account {
  id        String   @id @default(cuid())
  userId    String
  bankName  String
  accountNumber String
  ifscCode  String
  isPrimary Boolean  @default(false)
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("accounts")
}

model Wallet {
  id        String   @id @default(cuid())
  userId    String   @unique
  balance   Float    @default(0)
  currency  String   @default("INR")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  transactions Transaction[]

  @@map("wallets")
}

model Asset {
  id          String   @id @default(cuid())
  symbol      String   @unique
  name        String
  type        AssetType
  category    String?
  currentPrice Float?
  change24h   Float?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt DateTime @updatedAt

  holdings    Holding[]
  orders      Order[]
  
  @@map("assets")
}

model Portfolio {
  id        String   @id @default(cuid())
  userId    String
  name      String
  description String?
  totalValue Float    @default(0)
  riskLevel  Int      @default(1)
  createdAt  DateTime @default(now())
  updatedAt DateTime @updatedAt

  user       User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  holdings   Holding[]
  
  @@map("portfolios")
}

model Holding {
  id          String   @id @default(cuid())
  portfolioId String
  assetId     String
  quantity    Float
  avgBuyPrice Float
  currentPrice Float
  totalValue  Float
  returns     Float
  createdAt   DateTime @default(now())
  updatedAt DateTime @updatedAt

  portfolio   Portfolio @relation(fields: [portfolioId], references: [id], onDelete: Cascade)
  asset       Asset     @relation(fields: [assetId], references: [id], onDelete: Cascade)
  
  @@unique([portfolioId, assetId])
  @@map("holdings")
}

model Order {
  id        String   @id @default(cuid())
  userId    String
  assetId   String
  type      OrderType
  orderType OrderSide
  quantity  Float
  price     Float
  status    OrderStatus @default(PENDING)
  totalAmount Float
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user      User  @relation(fields: [userId], references: [id], onDelete: Cascade)
  asset     Asset @relation(fields: [assetId], references: [id], onDelete: Cascade)
  
  @@map("orders")
}

model Transaction {
  id        String   @id @default(cuid())
  userId    String
  walletId  String?
  type      TransactionType
  amount    Float
  currency  String   @default("INR")
  status    TransactionStatus @default(PENDING)
  description String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  wallet    Wallet?  @relation(fields: [walletId], references: [id], onDelete: Cascade)
  
  @@map("transactions")
}

model KYCDocument {
  id        String   @id @default(cuid())
  userId    String
  type      String
  documentUrl String
  status    KYCStatus @default(PENDING)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user      User @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@map("kyc_documents")
}